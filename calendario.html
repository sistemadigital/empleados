<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calendario</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-page: #F8F9FA;
      --bg-content: #FFFFFF;
      --bg-input: #F4F5F7;
      --border: #E9ECEF;
      --text-primary: #212529;
      --text-secondary: #6C757D;
      --accent-blue: #0D6EFD;
      --success: #198754;
      /* Colores por tipo de evento */
      --color-audiencia: #D1F2E9; /* Verde suave */
      --color-gesel: #FFEADD;     /* Naranja suave */
      --color-vencimiento: #FFD6D6; /* Rojo suave */
      --color-recurso: #E8DAFF;   /* Violeta suave */
      --event-day-bg: #F0F7FF;
      --radius: 12px;
      --space: 16px;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background-color: var(--bg-page);
      color: var(--text-primary);
      padding: var(--space);
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      gap: 24px;
    }

    .main-panel {
      flex: 1;
    }

    .sidebar {
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .stats-cards {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 100px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border: 1px solid var(--border);
    }

    .stat-count {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      font-weight: 600;
      text-align: center;
    }

    .stat-card.audiencia {
      border-left: 4px solid #0D6EFD;
    }

    .stat-card.gesel {
      border-left: 4px solid #FD7E14;
    }

    .stat-card.vencimiento {
      border-left: 4px solid #DC3545;
    }

    .stat-card.recurso {
      border-left: 4px solid #6F42C1;
    }

    .nav-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .nav-btn {
      background: white;
      border: 1px solid var(--border);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-primary);
    }

    .nav-btn.today {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
      width: auto;
      padding: 0 12px;
    }

    .filters {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
    }

    .search-container {
      position: relative;
    }

    .search-btn {
      background: white;
      border: 1px solid var(--border);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      color: var(--text-secondary);
    }

    .search-input {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      width: 200px;
      display: none;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .search-input.active {
      display: block;
    }

    .btn-print {
      background: var(--success);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-print:hover {
      opacity: 0.9;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .view-toggle {
      display: flex;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .view-btn {
      background: var(--accent-blue);
      color: white;
      border: none;
      padding: 8px 16px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .view-btn:not(.active) {
      opacity: 0.7;
    }

    /* Calendario principal */
    .calendar-view {
      background: var(--bg-content);
      border-radius: var(--radius);
      margin-top: 16px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }

    .month-label {
      padding: 16px 24px;
      font-size: 20px;
      font-weight: 700;
      background: #fafafa;
      border-bottom: 1px solid var(--border);
    }

    /* Vista D√≠a */
    .day-view-table {
      width: 100%;
      border-collapse: collapse;
    }

    .day-view-table th,
    .day-view-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .day-view-table th {
      background: #fafafa;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .time-cell {
      width: 120px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .event-cell {
      position: relative;
    }

    .event-badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      cursor: pointer;
    }

    .event-badge.audiencia { background: var(--color-audiencia); }
    .event-badge.gesel { background: var(--color-gesel); }
    .event-badge.vencimiento { background: var(--color-vencimiento); }
    .event-badge.recurso { background: var(--color-recurso); }

    .event-time {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 4px;
    }

    /* Vista Semana */
    .week-header {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      background: #fafafa;
      border-bottom: 1px solid var(--border);
    }

    .day-header {
      padding: 16px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
    }

    .day-header.today {
      color: var(--accent-blue);
      font-weight: 700;
    }

    .week-days {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      min-height: 600px;
    }

    .day-cell {
      border-right: 1px solid var(--border);
      padding: 12px;
      position: relative;
    }

    .day-cell:last-child {
      border-right: none;
    }

    .day-number {
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      justify-content: flex-end;
    }

    .day-cell.has-event {
      background-color: var(--event-day-bg);
    }

    .event {
      background: var(--color-audiencia);
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      word-break: break-word;
      cursor: pointer;
    }

    .event.gesel { background: var(--color-gesel); }
    .event.vencimiento { background: var(--color-vencimiento); }
    .event.recurso { background: var(--color-recurso); }

    /* Vista Mes */
    .month-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: var(--border);
      padding: 1px;
    }

    .month-day {
      background: white;
      min-height: 100px;
      padding: 8px;
      position: relative;
    }

    .month-day-header {
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      justify-content: flex-end;
    }

    .month-day.other-month {
      background: #f8f9fa;
      color: var(--text-secondary);
    }

    .month-event {
      display: block;
      padding: 4px;
      margin-top: 4px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .month-event.audiencia { background: var(--color-audiencia); }
    .month-event.gesel { background: var(--color-gesel); }
    .month-event.vencimiento { background: var(--color-vencimiento); }
    .month-event.recurso { background: var(--color-recurso); }

    /* Sidebar - Mini calendario */
    .mini-calendar {
      background: var(--bg-content);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .mini-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      font-weight: 600;
      font-size: 16px;
    }

    .mini-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .mini-day-name {
      text-align: center;
      font-size: 11px;
      color: var(--text-secondary);
      padding: 4px 0;
    }

    .mini-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      border-radius: 50%;
      cursor: pointer;
    }

    .mini-day.other-month {
      color: var(--text-secondary);
      opacity: 0.4;
    }

    .mini-day.today {
      background: var(--accent-blue);
      color: white;
    }

    .mini-day.has-event {
      position: relative;
    }

    .mini-day.has-event::after {
      content: '';
      position: absolute;
      bottom: 2px;
      width: 4px;
      height: 4px;
      background: var(--accent-blue);
      border-radius: 50%;
    }

    /* Eventos del d√≠a */
    .today-events {
      background: var(--bg-content);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-top: 16px;
    }

    .today-events h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .event-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .event-item {
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .event-item.audiencia { background: var(--color-audiencia); }
    .event-item.gesel { background: var(--color-gesel); }
    .event-item.vencimiento { background: var(--color-vencimiento); }
    .event-item.recurso { background: var(--color-recurso); }

    .event-item-time {
      font-size: 11px;
      opacity: 0.8;
      margin-top: 2px;
    }

    /* Resumen del mes */
    .month-stats {
      background: var(--bg-content);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-top: 16px;
    }

    .month-stats h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .stats-table th,
    .stats-table td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .stats-table th {
      font-weight: 600;
      color: var(--text-secondary);
    }

    .stats-table tr:last-child td {
      border-bottom: none;
    }

    .stats-count {
      font-weight: 600;
      text-align: right;
    }

    /* Modal de detalles de causa */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.hidden {
      display: none;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 4px 20px rgba(0,0,0,.3);
      width: 450px;
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-content h3 {
      margin-bottom: 10px;
      color: var(--accent-blue);
    }

    .close {
      float: right;
      font-size: 20px;
      cursor: pointer;
    }

    .btn-print-modal {
      margin-top: 12px;
      background: var(--accent-blue);
      color: #fff;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: .9rem;
    }

    .btn-print-modal:hover {
      opacity: .9;
    }

    /* Responsive */
    @media (max-width: 1100px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
      }
      .mini-calendar, .today-events, .month-stats {
        flex: 1;
        min-width: 280px;
      }
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-left, .header-right {
        width: 100%;
        justify-content: space-between;
      }
      .nav-controls {
        width: 100%;
        justify-content: space-between;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }
      .stats-cards {
        width: 100%;
        justify-content: space-between;
        margin-bottom: 16px;
      }
      .stat-card {
        flex: 1;
        min-width: 80px;
      }
      .week-header,
      .week-days,
      .month-grid {
        grid-template-columns: 1fr;
      }
      .day-cell {
        border-right: none;
        border-bottom: 1px solid var(--border);
        min-height: 200px;
      }
      .day-cell:last-child {
        border-bottom: none;
      }
      .month-day {
        min-height: 80px;
      }
    }

    @media (max-width: 480px) {
      .stats-cards {
        gap: 8px;
      }
      .stat-card {
        min-width: 70px;
        padding: 8px 10px;
      }
      .stat-count {
        font-size: 20px;
      }
      .stat-label {
        font-size: 10px;
      }
      .month-stats {
        padding: 12px;
      }
      .stats-table th,
      .stats-table td {
        padding: 6px 8px;
      }
    }

    /* Estilos para impresi√≥n */
    @media print {
      body * {
        visibility: hidden;
      }
      .print-content, .print-content * {
        visibility: visible;
      }
      .print-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Panel principal -->
    <div class="main-panel">
      <div class="header">
        <div class="header-left">
          <!-- Tarjetas de estad√≠sticas -->
          <div class="stats-cards">
            <div class="stat-card audiencia">
              <div class="stat-count" id="count-audiencia">0</div>
              <div class="stat-label">Audiencias</div>
            </div>
            <div class="stat-card gesel">
              <div class="stat-count" id="count-gesel">0</div>
              <div class="stat-label">C√°mara Gesell</div>
            </div>
            <div class="stat-card vencimiento">
              <div class="stat-count" id="count-vencimiento">0</div>
              <div class="stat-label">Vencimientos</div>
            </div>
            <div class="stat-card recurso">
              <div class="stat-count" id="count-recurso">0</div>
              <div class="stat-label">Recursos</div>
            </div>
          </div>
          
          <div class="nav-controls">
            <button class="nav-btn" id="prevBtn">‚Äπ</button>
            <button class="nav-btn today" id="todayBtn">Hoy</button>
            <button class="nav-btn" id="nextBtn">‚Ä∫</button>
            
            <div class="filters">
              <select id="filterTipo" class="filter-select">
                <option value="">Todos</option>
                <option value="Audiencia">Audiencias</option>
                <option value="C√°mara Gesell">C√°mara Gesell</option>
                <option value="Vencimiento">Vencimientos</option>
                <option value="Vencimiento Recurso">Vencimientos Recurso</option>
              </select>
            </div>
            
            <div class="search-container">
              <button class="search-btn" id="searchBtn">üîç</button>
              <input type="text" class="search-input" id="searchInput" placeholder="Buscar eventos..." />
            </div>

            <button class="btn-print" id="btnPrintView">
              üñ®Ô∏è Imprimir Vista
            </button>
          </div>
        </div>

        <div class="header-right">
          <div class="view-toggle">
            <button class="view-btn" data-view="day">D√≠a</button>
            <button class="view-btn active" data-view="week">Semana</button>
            <button class="view-btn" data-view="month">Mes</button>
          </div>
        </div>
      </div>

      <div class="calendar-view">
        <div class="month-label" id="mainMonthLabel">Junio 2024</div>
        <div id="calendarContent"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="mini-calendar">
        <div class="mini-header">
          <span id="miniMonthLabel">Junio 2024</span>
        </div>
        <div class="mini-grid" id="miniCalendarGrid"></div>
      </div>

      <div class="today-events">
        <h3>Eventos de Hoy</h3>
        <div class="event-list" id="todayEventsList"></div>
      </div>
      
      <!-- Nueva secci√≥n: Resumen del mes -->
      <div class="month-stats">
        <h3>Resumen del Mes</h3>
        <table class="stats-table">
          <thead>
            <tr>
              <th>Tipo</th>
              <th class="stats-count">Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Audiencias</td>
              <td class="stats-count" id="month-audiencia">0</td>
            </tr>
            <tr>
              <td>C√°mara Gesell</td>
              <td class="stats-count" id="month-gesel">0</td>
            </tr>
            <tr>
              <td>Vencimientos</td>
              <td class="stats-count" id="month-vencimiento">0</td>
            </tr>
            <tr>
              <td>Recursos</td>
              <td class="stats-count" id="month-recurso">0</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal para detalles de causa -->
  <div id="modalCausa" class="modal hidden">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <h3>Detalle de la Causa</h3>
      <div id="modalBody"></div>
      <button id="btnPrintCausa" class="btn-print-modal">üñ®Ô∏è Imprimir Causa</button>
    </div>
  </div>

  <script>
    // Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBt6X0u0BpiNPcV2SNPrN-spCmjl2AhZaA",
      authDomain: "causas-defensoria.firebaseapp.com",
      projectId: "causas-defensoria",
      storageBucket: "causas-defensoria.firebasestorage.app",
      messagingSenderId: "186064671470",
      appId: "1:186064671470:web:b58bae5eadbe6e469f19ff"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Estado
    let currentDate = new Date();
    let currentView = 'week'; // 'day', 'week', 'month'
    let events = [];
    let causasMap = {};
    let currentCausaId = null;
    const monthNames = [
      'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
    ];

    // Feriados
    const feriados = {
      "01-01":"A√±o Nuevo","24-03":"D√≠a de la Memoria","02-04":"Malvinas y Ca√≠dos","01-05":"D√≠a del Trabajador",
      "25-05":"D√≠a de la Patria","20-06":"Paso a la Inmortalidad de Belgrano","09-07":"Independencia","17-08":"San Mart√≠n",
      "10-10":"Feriado","12-10":"Diversidad Cultural","17-11":"Feriado- D√≠a del Empleado Judicial", "21-11":"Soberan√≠a Nacional", 
      "24-11":"Soberan√≠a Nacional","08-12":"Inmaculada Concepci√≥n","25-12":"Navidad"
    };

    // DOM
    const mainMonthLabel = document.getElementById('mainMonthLabel');
    const calendarContent = document.getElementById('calendarContent');
    const miniMonthLabel = document.getElementById('miniMonthLabel');
    const miniCalendarGrid = document.getElementById('miniCalendarGrid');
    const todayEventsList = document.getElementById('todayEventsList');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const todayBtn = document.getElementById('todayBtn');
    const viewButtons = document.querySelectorAll('.view-btn');
    const filterTipo = document.getElementById('filterTipo');
    const modalCausa = document.getElementById('modalCausa');
    const modalBody = document.getElementById('modalBody');
    const closeModal = document.getElementById('closeModal');
    const btnPrintCausa = document.getElementById('btnPrintCausa');
    const btnPrintView = document.getElementById('btnPrintView');
    
    // Elementos para las tarjetas de estad√≠sticas
    const countAudiencia = document.getElementById('count-audiencia');
    const countGesel = document.getElementById('count-gesel');
    const countVencimiento = document.getElementById('count-vencimiento');
    const countRecurso = document.getElementById('count-recurso');
    
    // Elementos para la tabla de resumen del mes
    const monthAudiencia = document.getElementById('month-audiencia');
    const monthGesel = document.getElementById('month-gesel');
    const monthVencimiento = document.getElementById('month-vencimiento');
    const monthRecurso = document.getElementById('month-recurso');

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
      setupEventListeners();
      loadEventsFromFirebase();
    });

    // Cargar eventos desde Firebase
    function loadEventsFromFirebase() {
      db.collection("causas").onSnapshot((querySnapshot) => {
        events = [];
        causasMap = {};
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const id = data.numCausa || doc.id;
          causasMap[id] = data;
          
          // Funci√≥n para procesar fechas (individuales o arrays)
          const procesarFechas = (fechaData, tipo) => {
            if (!fechaData) return;
            
            // Si es un array de audiencias
            if (Array.isArray(fechaData)) {
              fechaData.forEach(fecha => {
                if (!fecha) return;
                const f = fecha.seconds ? new Date(fecha.seconds * 1000) : new Date(fecha);
                if (!isNaN(f)) {
                  // Crear un evento para cada fecha
                  const eventType = tipo === "Audiencia" ? "audiencia" : 
                                  tipo === "C√°mara Gesell" ? "gesel" : 
                                  tipo === "Vencimiento Recurso" ? "recurso" : "vencimiento";
                  
                  events.push({
                    id: `${id}-${tipo}-${f.getTime()}`,
                    title: `${tipo} - Causa N¬∫ ${id}`,
                    type: eventType,
                    date: formatDate(f),
                    start: formatTime(f),
                    end: calculateEndTime(f),
                    causaId: id,
                    fechaCompleta: f,
                    tipoOriginal: tipo
                  });
                }
              });
            } 
            // Si es una fecha individual (formato antiguo)
            else {
              const f = fechaData.seconds ? new Date(fechaData.seconds * 1000) : new Date(fechaData);
              if (!isNaN(f)) {
                const eventType = tipo === "Audiencia" ? "audiencia" : 
                                tipo === "C√°mara Gesell" ? "gesel" : 
                                tipo === "Vencimiento Recurso" ? "recurso" : "vencimiento";
                
                events.push({
                  id: `${id}-${tipo}`,
                  title: `${tipo} - Causa N¬∫ ${id}`,
                  type: eventType,
                  date: formatDate(f),
                  start: formatTime(f),
                  end: calculateEndTime(f),
                  causaId: id,
                  fechaCompleta: f,
                  tipoOriginal: tipo
                });
              }
            }
          };
          
          // Procesar todos los tipos de eventos
          procesarFechas(data.audiencias, "Audiencia");
          procesarFechas(data.audienciaGesell, "C√°mara Gesell");
          procesarFechas(data.vencimiento, "Vencimiento");
          procesarFechas(data.vencimientoRecursos, "Vencimiento Recurso");
        });
        
        updateStatsCards();
        updateMonthStats();
        renderAll();
      }, (error) => {
        console.error("Error cargando causas:", error);
        // Datos de ejemplo si no hay conexi√≥n a Firebase
        events = [
          {
            id: 1,
            title: "Audiencia Penal - Causa N¬∫ 12345",
            type: "audiencia",
            tipoOriginal: "Audiencia",
            date: formatDate(new Date()),
            start: "09:00",
            end: "10:00",
            causaId: "12345",
            fechaCompleta: new Date()
          },
          {
            id: 2,
            title: "Vencimiento de recurso - Causa N¬∫ 67890",
            type: "recurso",
            tipoOriginal: "Vencimiento Recurso",
            date: formatDate(new Date()),
            start: "14:30",
            end: "15:30",
            causaId: "67890",
            fechaCompleta: new Date()
          },
          {
            id: 3,
            title: "Audiencia Gesell - Causa N¬∫ 54321",
            type: "gesel",
            tipoOriginal: "C√°mara Gesell",
            date: formatDate(new Date(new Date().setDate(new Date().getDate() + 3))),
            start: "11:00",
            end: "12:00",
            causaId: "54321",
            fechaCompleta: new Date(new Date().setDate(new Date().getDate() + 3))
          }
        ];
        updateStatsCards();
        updateMonthStats();
        renderAll();
      });
    }

    // Actualizar las tarjetas de estad√≠sticas
    function updateStatsCards() {
      const counts = {
        audiencia: 0,
        gesel: 0,
        vencimiento: 0,
        recurso: 0
      };
      
      events.forEach(event => {
        if (counts.hasOwnProperty(event.type)) {
          counts[event.type]++;
        }
      });
      
      countAudiencia.textContent = counts.audiencia;
      countGesel.textContent = counts.gesel;
      countVencimiento.textContent = counts.vencimiento;
      countRecurso.textContent = counts.recurso;
    }
    
    // Actualizar la tabla de resumen del mes
    function updateMonthStats() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      // Obtener el primer y √∫ltimo d√≠a del mes actual
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      // Inicializar contadores
      const counts = {
        audiencia: 0,
        gesel: 0,
        vencimiento: 0,
        recurso: 0
      };
      
      // Filtrar eventos del mes actual
      const filtered = getFilteredEvents();
      
      filtered.forEach(event => {
        const eventDate = parseDate(event.date);
        // Verificar si el evento est√° en el mes actual
        if (eventDate.getMonth() === month && eventDate.getFullYear() === year) {
          if (counts.hasOwnProperty(event.type)) {
            counts[event.type]++;
          }
        }
      });
      
      // Actualizar la tabla
      monthAudiencia.textContent = counts.audiencia;
      monthGesel.textContent = counts.gesel;
      monthVencimiento.textContent = counts.vencimiento;
      monthRecurso.textContent = counts.recurso;
    }

    function setupEventListeners() {
      // Cambiar vista
      viewButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          viewButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentView = btn.dataset.view;
          renderAll();
        });
      });

      // Navegaci√≥n
      prevBtn.addEventListener('click', () => {
        if (currentView === 'day') {
          currentDate.setDate(currentDate.getDate() - 1);
        } else if (currentView === 'week') {
          currentDate.setDate(currentDate.getDate() - 7);
        } else if (currentView === 'month') {
          currentDate.setMonth(currentDate.getMonth() - 1);
        }
        renderAll();
      });

      nextBtn.addEventListener('click', () => {
        if (currentView === 'day') {
          currentDate.setDate(currentDate.getDate() + 1);
        } else if (currentView === 'week') {
          currentDate.setDate(currentDate.getDate() + 7);
        } else if (currentView === 'month') {
          currentDate.setMonth(currentDate.getMonth() + 1);
        }
        renderAll();
      });

      todayBtn.addEventListener('click', () => {
        currentDate = new Date();
        renderAll();
      });

      // B√∫squeda
      let isSearchOpen = false;
      searchBtn.addEventListener('click', () => {
        isSearchOpen = !isSearchOpen;
        searchInput.classList.toggle('active', isSearchOpen);
        if (isSearchOpen) searchInput.focus();
      });
      document.addEventListener('click', (e) => {
        if (!searchBtn.contains(e.target) && !searchInput.contains(e.target)) {
          searchInput.classList.remove('active');
        }
      });
      searchInput.addEventListener('input', renderAll);

      // Filtro por tipo
      filterTipo.addEventListener('change', renderAll);

      // Modal
      closeModal.addEventListener('click', () => {
        modalCausa.classList.add('hidden');
      });
      
      window.addEventListener('click', (e) => {
        if (e.target === modalCausa) {
          modalCausa.classList.add('hidden');
        }
      });

      // Imprimir causa
      btnPrintCausa.addEventListener('click', () => {
        if (!currentCausaId) return;
        const html = `<h2>Causa N¬∫ ${currentCausaId}</h2>` + modalBody.innerHTML;
        const w = window.open("", "", "width=800,height=600");
        w.document.write(`<html><head><title>Causa ${currentCausaId}</title></head><body>${html}</body></html>`);
        w.document.close();
        w.focus();
        w.print();
      });

      // Imprimir vista actual
      btnPrintView.addEventListener('click', printCurrentView);
    }

    // Funci√≥n para imprimir la vista actual
    function printCurrentView() {
      const filtered = getFilteredEvents();
      let printContent = '';
      const title = `Calendario - ${mainMonthLabel.textContent}`;
      const filterText = filterTipo.value ? ` - Filtro: ${filterTipo.options[filterTipo.selectedIndex].text}` : '';
      const searchText = searchInput.value ? ` - B√∫squeda: "${searchInput.value}"` : '';
      
      printContent += `<h1>${title}${filterText}${searchText}</h1>`;
      printContent += `<p>Vista: ${currentView.charAt(0).toUpperCase() + currentView.slice(1)}</p>`;
      
      if (currentView === 'day') {
        printContent += renderDayViewForPrint(filtered);
      } else if (currentView === 'week') {
        printContent += renderWeekViewForPrint(filtered);
      } else if (currentView === 'month') {
        printContent += renderMonthViewForPrint(filtered);
      }
      
      const w = window.open("", "", "width=900,height=700");
      w.document.write(`
        <html>
          <head>
            <title>${title}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h1 { color: #0D6EFD; margin-bottom: 10px; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
              .event { margin-bottom: 5px; padding: 5px; border-radius: 4px; }
              .audiencia { background-color: #D1F2E9; }
              .gesel { background-color: #FFEADD; }
              .vencimiento { background-color: #FFD6D6; }
              .recurso { background-color: #E8DAFF; }
              .month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; }
              .month-day { border: 1px solid #ddd; padding: 5px; min-height: 80px; }
              .month-day-header { font-weight: bold; margin-bottom: 5px; }
              .month-event { font-size: 10px; margin-top: 2px; padding: 2px; border-radius: 2px; }
            </style>
          </head>
          <body>
            <div class="print-content">
              ${printContent}
            </div>
          </body>
        </html>
      `);
      w.document.close();
      w.focus();
      w.print();
    }

    // Funciones para generar contenido para impresi√≥n
    function renderDayViewForPrint(eventsList) {
      const dateStr = formatDate(currentDate);
      const dayEvents = eventsList.filter(e => e.date === dateStr);
      
      let html = `<h2>Vista del D√≠a: ${dateStr}</h2>`;
      
      if (dayEvents.length === 0) {
        html += '<p>No hay eventos para este d√≠a.</p>';
        return html;
      }
      
      html += `
        <table>
          <thead>
            <tr>
              <th>Hora</th>
              <th>Evento</th>
              <th>Tipo</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      // Generar horas de 8 AM a 8 PM
      for (let h = 8; h <= 20; h++) {
        const hour24 = h.toString().padStart(2, '0');
        const timeLabel = `${h}:00`;
        const eventsAtHour = dayEvents.filter(e => {
          const startHour = parseInt(e.start.split(':')[0]);
          return startHour === h;
        });

        if (eventsAtHour.length > 0) {
          eventsAtHour.forEach((e, idx) => {
            html += `
              <tr>
                ${idx === 0 ? `<td rowspan="${eventsAtHour.length}">${timeLabel}</td>` : ''}
                <td>${e.title}</td>
                <td>${e.tipoOriginal}</td>
              </tr>
            `;
          });
        } else {
          html += `
            <tr>
              <td>${timeLabel}</td>
              <td></td>
              <td></td>
            </tr>
          `;
        }
      }

      html += `
          </tbody>
        </table>
      `;
      
      return html;
    }

    function renderWeekViewForPrint(eventsList) {
      const monday = getMonday(currentDate);
      const weekDates = [];
      for (let i = 0; i < 5; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        weekDates.push(d);
      }
      
      let html = `<h2>Vista de la Semana: ${formatDate(weekDates[0])} - ${formatDate(weekDates[4])}</h2>`;
      
      let hasEvents = false;
      weekDates.forEach(date => {
        const dateStr = formatDate(date);
        const dayEvents = eventsList.filter(e => e.date === dateStr);
        
        if (dayEvents.length > 0) {
          hasEvents = true;
          html += `<h3>${dateStr}</h3>`;
          dayEvents.forEach(e => {
            html += `<div class="event ${e.type}">${e.start} - ${e.end}: ${e.title}</div>`;
          });
        }
      });
      
      if (!hasEvents) {
        html += '<p>No hay eventos para esta semana.</p>';
      }
      
      return html;
    }

    function renderMonthViewForPrint(eventsList) {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay(); // 0 = dom
      const daysInMonth = lastDay.getDate();
      
      let html = `<h2>Vista del Mes: ${monthNames[month]} ${year}</h2>`;
      html += '<div class="month-grid">';
      
      // Encabezados
      const dayNames = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
      dayNames.forEach(name => {
        html += `<div class="month-day" style="text-align:center;font-weight:bold;background:#f2f2f2;">${name}</div>`;
      });

      // D√≠as del mes anterior
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      for (let i = startDay === 0 ? 6 : startDay - 1; i >= 0; i--) {
        const day = prevMonthLastDay - i;
        html += `<div class="month-day" style="background:#f9f9f9;color:#999;">${day}</div>`;
      }

      // D√≠as del mes actual
      const todayStr = formatDate(new Date());
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDate(new Date(year, month, day));
        const isToday = dateStr === todayStr;
        const dayEvents = eventsList.filter(e => e.date === dateStr);

        let eventsHTML = '';
        dayEvents.forEach(e => {
          eventsHTML += `<div class="month-event ${e.type}">${e.title}</div>`;
        });

        html += `
          <div class="month-day" style="${isToday ? 'background:#e6f3ff;' : ''}">
            <div class="month-day-header">${day}</div>
            ${eventsHTML}
          </div>
        `;
      }

      // D√≠as del mes siguiente
      const totalCells = 42;
      const daysSoFar = startDay === 0 ? 6 + 1 : startDay + daysInMonth;
      const nextDays = totalCells - daysSoFar;
      for (let day = 1; day <= nextDays; day++) {
        html += `<div class="month-day" style="background:#f9f9f9;color:#999;">${day}</div>`;
      }

      html += '</div>';
      return html;
    }

    // Formatear fecha a DD/MM/AAAA
    function formatDate(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    // Formatear hora a HH:MM
    function formatTime(date) {
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    // Calcular hora de finalizaci√≥n (1 hora despu√©s por defecto)
    function calculateEndTime(date) {
      const endDate = new Date(date);
      endDate.setHours(endDate.getHours() + 1);
      return formatTime(endDate);
    }

    // Convertir DD/MM/AAAA a objeto Date
    function parseDate(dateStr) {
      const [day, month, year] = dateStr.split('/').map(Number);
      return new Date(year, month - 1, day);
    }

    function getFilteredEvents() {
      const query = searchInput.value.trim().toLowerCase();
      const tipoFilter = filterTipo.value;
      
      return events.filter(e => {
        // Filtro por b√∫squeda de texto
        const matchesSearch = !query || 
          e.title.toLowerCase().includes(query) ||
          e.type.toLowerCase().includes(query) ||
          e.date.includes(query) ||
          e.start.includes(query);
        
        // Filtro por tipo
        let matchesTipo = true;
        if (tipoFilter) {
          matchesTipo = e.tipoOriginal === tipoFilter;
        }
        
        return matchesSearch && matchesTipo;
      });
    }

    function renderAll() {
      renderMainCalendar();
      renderMiniCalendar();
      renderTodayEvents();
      updateMonthStats();
    }

    function renderMainCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      mainMonthLabel.textContent = `${monthNames[month]} ${year}`;

      const filtered = getFilteredEvents();

      if (currentView === 'day') {
        renderDayView(filtered);
      } else if (currentView === 'week') {
        renderWeekView(filtered);
      } else if (currentView === 'month') {
        renderMonthView(filtered);
      }
    }

    function renderDayView(eventsList) {
      const dateStr = formatDate(currentDate);
      const dayEvents = eventsList.filter(e => e.date === dateStr);

      let html = `
        <table class="day-view-table">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Evento</th>
            </tr>
          </thead>
          <tbody>
      `;

      // Generar horas de 8 AM a 8 PM
      for (let h = 8; h <= 20; h++) {
        const hour24 = h.toString().padStart(2, '0');
        const timeLabel = `${h}:00`;
        const eventsAtHour = dayEvents.filter(e => {
          const startHour = parseInt(e.start.split(':')[0]);
          return startHour === h;
        });

        if (eventsAtHour.length > 0) {
          eventsAtHour.forEach((e, idx) => {
            html += `
              <tr>
                ${idx === 0 ? `<td rowspan="${eventsAtHour.length}" class="time-cell">${timeLabel}</td>` : ''}
                <td class="event-cell">
                  <div class="event-badge ${e.type}" data-causa-id="${e.causaId}">${e.title}</div>
                  <div class="event-time">${e.start} ‚Äì ${e.end}</div>
                </td>
              </tr>
            `;
          });
        } else {
          html += `
            <tr>
              <td class="time-cell">${timeLabel}</td>
              <td></td>
            </tr>
          `;
        }
      }

      html += `
          </tbody>
        </table>
      `;

      calendarContent.innerHTML = html;
      
      // Agregar event listeners a los eventos para abrir el modal
      document.querySelectorAll('.event-badge').forEach(badge => {
        badge.addEventListener('click', () => {
          const causaId = badge.dataset.causaId;
          showCausaDetails(causaId);
        });
      });
    }

    function getMonday(d) {
      const date = new Date(d);
      const day = date.getDay();
      const diff = date.getDate() - day + (day === 0 ? -6 : 1);
      return new Date(date.setDate(diff));
    }

    function renderWeekView(eventsList) {
      const monday = getMonday(currentDate);
      const weekDates = [];
      for (let i = 0; i < 5; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        weekDates.push(d);
      }

      let headerHTML = '';
      let daysHTML = '';

      const todayStr = formatDate(new Date());

      weekDates.forEach((date, i) => {
        const dateStr = formatDate(date);
        const dayNum = date.getDate();
        const isToday = dateStr === todayStr;
        const weekdayShort = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie'];

        headerHTML += `<div class="day-header ${isToday ? 'today' : ''}">${weekdayShort[i]} ${dayNum}</div>`;

        let eventsHTML = '';
        const dayEvents = eventsList.filter(e => e.date === dateStr);
        if (dayEvents.length > 0) {
          dayEvents.forEach(e => {
            eventsHTML += `
              <div class="event ${e.type}" data-causa-id="${e.causaId}">
                <div>${e.title}</div>
                <div class="event-time">${e.start} ‚Äì ${e.end}</div>
              </div>
            `;
          });
        }

        daysHTML += `
          <div class="day-cell ${dayEvents.length > 0 ? 'has-event' : ''}">
            <div class="day-number">${dayNum}</div>
            ${eventsHTML}
          </div>
        `;
      });

      calendarContent.innerHTML = `
        <div class="week-header">${headerHTML}</div>
        <div class="week-days">${daysHTML}</div>
      `;
      
      // Agregar event listeners a los eventos para abrir el modal
      document.querySelectorAll('.event').forEach(event => {
        event.addEventListener('click', () => {
          const causaId = event.dataset.causaId;
          showCausaDetails(causaId);
        });
      });
    }

    function renderMonthView(eventsList) {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay(); // 0 = dom
      const daysInMonth = lastDay.getDate();

      let gridHTML = '';

      // Encabezados
      const dayNames = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
      dayNames.forEach(name => {
        gridHTML += `<div class="month-day-header" style="font-weight:700;text-align:center;background:#fafafa;padding:8px;">${name}</div>`;
      });

      // D√≠as del mes anterior
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      for (let i = startDay === 0 ? 6 : startDay - 1; i >= 0; i--) {
        const day = prevMonthLastDay - i;
        gridHTML += `<div class="month-day other-month"><div class="month-day-header">${day}</div></div>`;
      }

      // D√≠as del mes actual
      const todayStr = formatDate(new Date());
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDate(new Date(year, month, day));
        const isToday = dateStr === todayStr;
        const dayEvents = eventsList.filter(e => e.date === dateStr);

        let eventsHTML = '';
        dayEvents.forEach(e => {
          eventsHTML += `<span class="month-event ${e.type}" data-causa-id="${e.causaId}">${e.title}</span>`;
        });

        gridHTML += `
          <div class="month-day ${isToday ? 'today' : ''}">
            <div class="month-day-header">${day}</div>
            ${eventsHTML}
          </div>
        `;
      }

      // D√≠as del mes siguiente
      const totalCells = 42;
      const daysSoFar = startDay === 0 ? 6 + 1 : startDay + daysInMonth;
      const nextDays = totalCells - daysSoFar;
      for (let day = 1; day <= nextDays; day++) {
        gridHTML += `<div class="month-day other-month"><div class="month-day-header">${day}</div></div>`;
      }

      calendarContent.innerHTML = `<div class="month-grid">${gridHTML}</div>`;
      
      // Agregar event listeners a los eventos para abrir el modal
      document.querySelectorAll('.month-event').forEach(event => {
        event.addEventListener('click', () => {
          const causaId = event.dataset.causaId;
          showCausaDetails(causaId);
        });
      });
    }

    function renderMiniCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      miniMonthLabel.textContent = `${monthNames[month]} ${year}`;
      miniCalendarGrid.innerHTML = '';

      // Encabezados
      ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'].forEach(name => {
        const el = document.createElement('div');
        el.className = 'mini-day-name';
        el.textContent = name;
        miniCalendarGrid.appendChild(el);
      });

      // D√≠as anteriores
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      for (let i = startDay === 0 ? 6 : startDay - 1; i >= 0; i--) {
        const day = prevMonthLastDay - i;
        const el = document.createElement('div');
        el.className = 'mini-day other-month';
        el.textContent = day;
        miniCalendarGrid.appendChild(el);
      }

      // D√≠as actuales
      const todayStr = formatDate(new Date());
      const filtered = getFilteredEvents();
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = formatDate(new Date(year, month, day));
        const el = document.createElement('div');
        el.className = 'mini-day';
        el.textContent = day;
        if (dateStr === todayStr) el.classList.add('today');
        if (filtered.some(e => e.date === dateStr)) el.classList.add('has-event');
        miniCalendarGrid.appendChild(el);
      }

      // D√≠as siguientes
      const totalCells = 42;
      const daysSoFar = startDay === 0 ? 6 + 1 : startDay + daysInMonth;
      const nextDays = totalCells - daysSoFar;
      for (let day = 1; day <= nextDays; day++) {
        const el = document.createElement('div');
        el.className = 'mini-day other-month';
        el.textContent = day;
        miniCalendarGrid.appendChild(el);
      }
    }

    function renderTodayEvents() {
      const todayStr = formatDate(new Date());
      const filtered = getFilteredEvents();
      const todayEvents = filtered.filter(e => e.date === todayStr);
      todayEventsList.innerHTML = '';

      if (todayEvents.length === 0) {
        todayEventsList.innerHTML = '<div style="color: var(--text-secondary); font-style: italic;">No hay eventos hoy</div>';
        return;
      }

      todayEvents.forEach(e => {
        const el = document.createElement('div');
        el.className = `event-item ${e.type}`;
        el.setAttribute('data-causa-id', e.causaId);
        el.innerHTML = `
          <div>${e.title}</div>
          <div class="event-item-time">${e.start} ‚Äì ${e.end}</div>
        `;
        todayEventsList.appendChild(el);
      });
      
      // Agregar event listeners a los eventos para abrir el modal
      document.querySelectorAll('.event-item').forEach(item => {
        item.addEventListener('click', () => {
          const causaId = item.dataset.causaId;
          showCausaDetails(causaId);
        });
      });
    }

    function showCausaDetails(causaId) {
      const causa = causasMap[causaId];
      if (!causa) return;
      
      currentCausaId = causaId;
      let body = `<p><b>numCausa:</b> ${causaId}</p>`;
      for (const [key, value] of Object.entries(causa)) {
        let formattedValue = value;
        // Manejo de fechas y timestamps
        if (value && value.seconds) {
          // Si la clave es "fechaInicio", solo mostrar la fecha
          if (key === "fechaInicio") {
              formattedValue = new Date(value.seconds * 1000).toLocaleDateString("es-ES");
          } else {
              // Para otros timestamps, mostrar fecha y hora
              formattedValue = new Date(value.seconds * 1000).toLocaleString("es-ES");
          }
        }
        // Manejo de arrays, verificando cada elemento
        else if (Array.isArray(value)) {
          const formattedDates = value.map(item => {
            if (item && item.seconds) {
              return new Date(item.seconds * 1000).toLocaleString("es-ES");
            }
            return item;
          });
          formattedValue = formattedDates.join(", ");
        }
        body += `<p><b>${key}:</b> ${formattedValue ?? "-"}</p>`;
      }
      modalBody.innerHTML = body;
      modalCausa.classList.remove('hidden');
    }
  </script>
</body>
</html>